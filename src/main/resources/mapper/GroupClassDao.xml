<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fitness.api.dao.GroupClassDao">

    <!--创建团课-->
    <insert id="add" parameterType="com.fitness.api.domain.GroupClass">
        INSERT INTO group_class(name,
        total,
        address,
        surplusNum,
        startDate,
        endDate,
        timeTotal,
        status,
        createDate,
        updateDate,
        mainImgUrl,
        coachId,
        status
        )
        VALUES (#{name},
        #{total},
        #{address},
        #{surplusNum},
        #{startDate},
        #{endDate},
        #{timeTotal},
        #{status},
        now(),
        now(),
        #{mainImgUrl},
        #{coachId},
        '1')
    </insert>

    <!--修改团课-->
    <update id="update" parameterType="com.fitness.api.domain.GroupClass">
        UPDATE group_class SET name=#{name},
        total=#{total},
        address=#{address},
        surplusNum=#{surplusNum},
        startDate=#{startDate},
        endDate=#{endDate},
        timeTotal=#{timeTotal},
        status=#{status},
        updateDate=now(),
        mainImgUrl=#{mainImgUrl},
        coachId=#{coachId}
        WHERE id=#{id}
    </update>

    <!--团课详情-->
    <select id="classInfo" resultType="com.fitness.api.domain.GroupClass">
        SELECT
         gc.id,
         gc.name,
         gc.total,
         gc.address,
         gc.surplusNum,
         gc.startDate,
         gc.endDate,
         gc.time,
         gc.status,
         gc.createDate,
         gc.updateDate,
         gc.mainImgUrl,
         gc.coachId,
         c.name as coachName,
         s.name as stadiumName,
         s.id as stadiumId
         FROM group_class gc LEFT JOIN coach c ON gc.coachId=c.id LEFT JOIN stadium s ON s.id=c.stadiumId
        WHERE gc.id=#{id}
    </select>

    <!--检查教练当天有没有团课-->
    <select id="countByStartDate" resultType="java.lang.Integer">
        SELECT COUNT(1) FROM group_class gc WHERE gc.startDate=#{startDate} AND coachId=#{coachId}
    </select>
</mapper>